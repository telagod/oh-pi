# æ¨¡å—ä¾èµ–å›¾ä¸å•ä¸€èŒè´£åˆ†æ

> ç”Ÿæˆæ—¶é—´: 2026-02-16 | Worker Ant è‡ªåŠ¨åˆ†æ

---

## ä¸€ã€å®Œæ•´ ASCII æ¨¡å—ä¾èµ–å›¾

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        oh-pi å®Œæ•´æ¨¡å—ä¾èµ–å…³ç³»å›¾                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ src/ å±‚ (TUI é…ç½®å·¥å…·) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚    â•‘
â•‘  â”‚              â”‚ src/index.ts â”‚ â—„â”€â”€ ä¸»å…¥å£                              â”‚    â•‘
â•‘  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚    â•‘
â•‘  â”‚                     â”‚                                                 â”‚    â•‘
â•‘  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚    â•‘
â•‘  â”‚         â”‚           â”‚               â”‚                                 â”‚    â•‘
â•‘  â”‚         â–¼           â–¼               â–¼                                 â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚    â•‘
â•‘  â”‚  â”‚ i18n.ts  â”‚ â”‚ types.ts â”‚ â”‚ utils/detect.tsâ”‚                        â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚    â•‘
â•‘  â”‚                    â”‚                                                  â”‚    â•‘
â•‘  â”‚                    â”‚ (è¢« import)                                      â”‚    â•‘
â•‘  â”‚                    â–¼                                                  â”‚    â•‘
â•‘  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â•‘
â•‘  â”‚            â”‚utils/install.tsâ”‚â”€â”€â”€â”€â–¶â”‚ utils/resources.tsâ”‚              â”‚    â•‘
â•‘  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚  â€» src/index.ts è¿˜ import äº† 8 ä¸ª tui/* æ¨¡å—ï¼ˆå›¾ä¸­çœç•¥ï¼‰             â”‚    â•‘
â•‘  â”‚    welcome, mode-select, provider-setup, preset-select,               â”‚    â•‘
â•‘  â”‚    theme-select, keybinding-select, extension-select,                 â”‚    â•‘
â•‘  â”‚    agents-select, confirm-apply                                       â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                              â•‘
â•‘                          â•‘ æ— ç›´æ¥ import â•‘                                   â•‘
â•‘                          â•‘ é€šè¿‡ pi æ‰©å±•  â•‘                                   â•‘
â•‘                          â•‘ API æ¡¥æ¥      â•‘                                   â•‘
â•‘                          â–¼               â–¼                                   â•‘
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ant-colony/ å±‚ (èšç¾¤å¤š Agent ç³»ç»Ÿ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚    â•‘
â•‘  â”‚              â”‚ ant-colony/       â”‚ â—„â”€â”€ æ‰©å±•å…¥å£                       â”‚    â•‘
â•‘  â”‚              â”‚   index.ts        â”‚                                    â”‚    â•‘
â•‘  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚    â•‘
â•‘  â”‚                      â”‚                                                â”‚    â•‘
â•‘  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚    â•‘
â•‘  â”‚          â”‚           â”‚            â”‚                                   â”‚    â•‘
â•‘  â”‚          â–¼           â–¼            â–¼                                   â”‚    â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚    â•‘
â•‘  â”‚   â”‚ queen.ts  â”‚ â”‚ nest.ts â”‚ â”‚ types.ts â”‚ â—„â”€â”€ çº¯å¶èŠ‚ç‚¹               â”‚    â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚    â•‘
â•‘  â”‚         â”‚                         â–²                                   â”‚    â•‘
â•‘  â”‚         â”‚ imports                 â”‚ (è¢«æ‰€æœ‰æ¨¡å—ä¾èµ–)                   â”‚    â•‘
â•‘  â”‚    â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                                   â”‚    â•‘
â•‘  â”‚    â”‚    â”‚    â”‚        â”‚           â”‚                                   â”‚    â•‘
â•‘  â”‚    â–¼    â–¼    â–¼        â–¼           â”‚                                   â”‚    â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚    â•‘
â•‘  â”‚ â”‚spawner.tsâ”‚â”‚  deps.ts â”‚â”‚ concurrency.ts  â”‚                          â”‚    â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### è¯¦ç»†ä¾èµ–è¾¹åˆ—è¡¨

```
src/index.ts
  â”œâ”€â”€â–¶ src/i18n.ts              (selectLanguage, getLocale, t)
  â”œâ”€â”€â–¶ src/types.ts             (type OhPConfig)
  â”œâ”€â”€â–¶ src/utils/detect.ts      (detectEnv, type EnvInfo)
  â””â”€â”€â–¶ src/tui/*.ts Ã— 8        (welcome, mode-select, provider-setup, ...)

src/utils/install.ts
  â”œâ”€â”€â–¶ src/types.ts             (type OhPConfig, KEYBINDING_SCHEMES, MODEL_CAPABILITIES, PROVIDERS)
  â””â”€â”€â–¶ src/utils/resources.ts   (resources)

src/utils/detect.ts
  â””â”€â”€â–¶ (æ— å†…éƒ¨ä¾èµ–ï¼Œä»… node:* æ ‡å‡†åº“)

src/utils/resources.ts
  â””â”€â”€â–¶ (æ— å†…éƒ¨ä¾èµ–ï¼Œä»… node:path, node:url)

src/i18n.ts
  â””â”€â”€â–¶ (æ— å†…éƒ¨ä¾èµ–ï¼Œä»… @clack/prompts, node:child_process)

src/types.ts
  â””â”€â”€â–¶ (é›¶ä¾èµ–ï¼Œçº¯å¶èŠ‚ç‚¹)

ant-colony/index.ts
  â”œâ”€â”€â–¶ ant-colony/queen.ts      (runColony, resumeColony, QueenCallbacks)
  â”œâ”€â”€â–¶ ant-colony/nest.ts       (Nest)
  â””â”€â”€â–¶ ant-colony/types.ts      (ColonyState, ColonyMetrics, AntStreamEvent)

ant-colony/queen.ts              â—„â”€â”€ æœ€é«˜æ‰‡å‡º (5 ä¸ªå†…éƒ¨ä¾èµ–)
  â”œâ”€â”€â–¶ ant-colony/types.ts      (ColonyState, Task, Ant, AntCaste, ...)
  â”œâ”€â”€â–¶ ant-colony/nest.ts       (Nest)
  â”œâ”€â”€â–¶ ant-colony/spawner.ts    (spawnAnt, runDrone, makeTaskId)
  â”œâ”€â”€â–¶ ant-colony/concurrency.ts(adapt, sampleSystem, defaultConcurrency)
  â””â”€â”€â–¶ ant-colony/deps.ts       (buildImportGraph, taskDependsOn)

ant-colony/spawner.ts
  â”œâ”€â”€â–¶ ant-colony/types.ts      (Ant, AntCaste, AntConfig, Task, Pheromone, ...)
  â””â”€â”€â–¶ ant-colony/nest.ts       (Nest)

ant-colony/nest.ts
  â””â”€â”€â–¶ ant-colony/types.ts      (ColonyState, Task, Pheromone, Ant, ...)

ant-colony/concurrency.ts
  â””â”€â”€â–¶ ant-colony/types.ts      (ConcurrencyConfig, ConcurrencySample)

ant-colony/deps.ts
  â””â”€â”€â–¶ (é›¶å†…éƒ¨ä¾èµ–ï¼Œä»… node:fs, node:path)
```

---

## äºŒã€æ‰‡å…¥/æ‰‡å‡ºåˆ†æ

| æ¨¡å— | æ‰‡å…¥ (è¢«ä¾èµ–æ•°) | æ‰‡å‡º (ä¾èµ–æ•°) | è§’è‰² |
|------|:---:|:---:|------|
| `ant-colony/types.ts` | **6** | 0 | çº¯å¶èŠ‚ç‚¹ï¼Œå…¨å±‚åŸºç¡€ç±»å‹ |
| `src/types.ts` | **2** | 0 | å¶èŠ‚ç‚¹ï¼Œä½†æ··åˆäº†ç±»å‹+å¸¸é‡ |
| `ant-colony/nest.ts` | 3 | 1 | å…±äº«çŠ¶æ€ç®¡ç† |
| `ant-colony/queen.ts` | 1 | **5** | æœ€é«˜æ‰‡å‡ºï¼Œè°ƒåº¦ç¼–æ’æ ¸å¿ƒ |
| `ant-colony/spawner.ts` | 1 | 2 | Agent ç”Ÿå‘½å‘¨æœŸç®¡ç† |
| `ant-colony/index.ts` | 0 (å¤–éƒ¨å…¥å£) | 3 | æ‰©å±•æ³¨å†Œå…¥å£ |
| `src/index.ts` | 0 (å¤–éƒ¨å…¥å£) | 3+8 tui | TUI æµç¨‹ç¼–æ’ |
| `src/utils/install.ts` | 1 (confirm-apply) | 2 | é…ç½®æ–‡ä»¶ç”Ÿæˆ |
| `src/utils/resources.ts` | 1 | 0 | çº¯è·¯å¾„è§£æ |
| `src/utils/detect.ts` | 1 | 0 | ç¯å¢ƒæ£€æµ‹ |
| `src/i18n.ts` | 1+ | 0 | å›½é™…åŒ– |
| `ant-colony/concurrency.ts` | 1 | 1 | è‡ªé€‚åº”å¹¶å‘ |
| `ant-colony/deps.ts` | 1 | 0 | ä¾èµ–å›¾åˆ†æ |

---

## ä¸‰ã€å„æ¨¡å—æ ¸å¿ƒèŒè´£ä¸ SRP è¯„ä¼°

### src/ å±‚

#### 1. `src/index.ts` â€” TUI æµç¨‹ç¼–æ’å™¨
- **èŒè´£**: æ£€æµ‹ç¯å¢ƒ â†’ é€‰è¯­è¨€ â†’ æ¬¢è¿ â†’ é€‰æ¨¡å¼ â†’ æ‰§è¡Œå¯¹åº”æµç¨‹ â†’ ç¡®è®¤åº”ç”¨
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯ç¼–æ’é€»è¾‘ï¼Œæ¯ä¸ªæ­¥éª¤å§”æ‰˜ç»™ä¸“é—¨æ¨¡å—ï¼Œè‡ªèº«ä¸å«ä¸šåŠ¡ç»†èŠ‚

#### 2. `src/types.ts` â€” ç±»å‹å®šä¹‰ + è¿è¡Œæ—¶å¸¸é‡æ³¨å†Œè¡¨
- **èŒè´£**: å®šä¹‰ `OhPConfig`ã€`ProviderConfig` ç­‰æ¥å£ï¼ŒåŒæ—¶åŒ…å« 5 ä¸ªè¿è¡Œæ—¶å¸¸é‡æ³¨å†Œè¡¨ï¼š
  - `MODEL_CAPABILITIES` (L68-82) â€” æ¨¡å‹èƒ½åŠ›å‚æ•°æ˜ å°„
  - `PROVIDERS` (L85-93) â€” æä¾›å•†æ³¨å†Œè¡¨
  - `THEMES` (L96-105) â€” ä¸»é¢˜åˆ—è¡¨
  - `EXTENSIONS` (L108-118) â€” æ‰©å±•åˆ—è¡¨
  - `KEYBINDING_SCHEMES` (L121-135) â€” å¿«æ·é”®æ–¹æ¡ˆ
- **SRP è¯„ä¼°**: âŒ **è¿å** â€” æ··åˆäº†ä¸¤ä¸ªä¸åŒå˜åŒ–è½´ï¼š
  1. ç±»å‹å®šä¹‰ï¼ˆæ¥å£å˜æ›´æ—¶æ”¹ï¼‰
  2. è¿è¡Œæ—¶æ³¨å†Œè¡¨ï¼ˆæ–°å¢æ¨¡å‹/æä¾›å•†/ä¸»é¢˜æ—¶æ”¹ï¼‰
- **å»ºè®®**: å°† 5 ä¸ªå¸¸é‡æ³¨å†Œè¡¨æ‹†åˆ†åˆ° `src/registry.ts` æˆ–æŒ‰é¢†åŸŸæ‹†åˆ†ä¸º `src/registries/{models,providers,themes,extensions,keybindings}.ts`

#### 3. `src/i18n.ts` â€” å›½é™…åŒ–
- **èŒè´£**: ç®¡ç† 3 ç§è¯­è¨€çš„ç¿»è¯‘æ–‡æœ¬ï¼Œæä¾› `t()` æ’å€¼å‡½æ•°ã€è¯­è¨€æ£€æµ‹ã€è¯­è¨€é€‰æ‹©äº¤äº’
- **SRP è¯„ä¼°**: âš ï¸ **è½»å¾®è¿å** â€” ç¿»è¯‘æ•°æ®ï¼ˆé™æ€å­—å…¸ï¼‰å’Œç¿»è¯‘é€»è¾‘ï¼ˆ`t()` å‡½æ•°ï¼‰è€¦åˆåœ¨åŒä¸€æ–‡ä»¶ï¼Œä¸”åŒ…å« UI äº¤äº’ï¼ˆ`selectLanguage`ï¼‰ã€‚ä½†æ–‡ä»¶è§„æ¨¡å¯æ§ï¼Œå®é™…å½±å“ä¸å¤§ã€‚

#### 4. `src/utils/detect.ts` â€” ç¯å¢ƒæ£€æµ‹
- **èŒè´£**: æ£€æµ‹ pi å®‰è£…çŠ¶æ€ã€ç‰ˆæœ¬ã€å·²æœ‰é…ç½®ã€ç»ˆç«¯ä¿¡æ¯ã€å·²é…ç½® provider
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” å•ä¸€èŒè´£ï¼šæ”¶é›†ç¯å¢ƒä¿¡æ¯ã€‚æ‰€æœ‰å‡½æ•°å›´ç»•åŒä¸€ä¸ª `EnvInfo` è¾“å‡ºã€‚

#### 5. `src/utils/install.ts` â€” é…ç½®æ–‡ä»¶ç”Ÿæˆ
- **èŒè´£**: `applyConfig()` ç”Ÿæˆ 9 ç§é…ç½®æ–‡ä»¶ï¼š
  1. `auth.json` (L79-87)
  2. `settings.json` (L90-113)
  3. `models.json` (L116-153)
  4. `keybindings.json` (L156-159)
  5. `AGENTS.md` (L162-171)
  6. æ‰©å±•ç›®å½•å¤åˆ¶ (L174-181)
  7. æç¤ºè¯æ¨¡æ¿å¤åˆ¶ (L184-189)
  8. æŠ€èƒ½ç›®å½•åŒæ­¥ (L192-195)
  9. ä¸»é¢˜æ–‡ä»¶å¤åˆ¶ (L198-200)
- **SRP è¯„ä¼°**: âŒ **ä¸¥é‡è¿å** â€” å•ä¸ªå‡½æ•°æ‰¿æ‹… 9 ç§å®Œå…¨ä¸åŒçš„æ–‡ä»¶ç”Ÿæˆé€»è¾‘ã€‚ä»»ä½•ä¸€ç§æ–‡ä»¶æ ¼å¼å˜æ›´éƒ½éœ€è¦ä¿®æ”¹æ­¤å‡½æ•°ã€‚
- **å»ºè®®**: æ‹†åˆ†ä¸º Writer ç­–ç•¥æ¨¡å¼ï¼š
  ```
  src/writers/auth-writer.ts
  src/writers/settings-writer.ts
  src/writers/models-writer.ts
  ...
  src/utils/install.ts  â†’ ä»…ç¼–æ’å„ writer
  ```

#### 6. `src/utils/resources.ts` â€” èµ„æºè·¯å¾„è§£æ
- **èŒè´£**: å°†é€»è¾‘èµ„æºåæ˜ å°„åˆ° `pi-package/` ä¸‹çš„ç‰©ç†è·¯å¾„
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯å‡½æ•°ï¼Œå•ä¸€èŒè´£ï¼Œé›¶å‰¯ä½œç”¨

---

### ant-colony/ å±‚

#### 7. `ant-colony/index.ts` â€” æ‰©å±•å…¥å£ + UI æ¸²æŸ“ + å‘½ä»¤æ³¨å†Œ
- **èŒè´£**:
  1. æ³¨å†Œ `ant_colony` å·¥å…·ï¼ˆå¯åŠ¨èšç¾¤ï¼‰
  2. æ³¨å†Œ `bg_colony_status` å·¥å…·ï¼ˆæŸ¥è¯¢çŠ¶æ€ï¼‰
  3. æ³¨å†Œ `/colony-status`ã€`/colony-stop`ã€`/colony-resume` å‘½ä»¤
  4. ç®¡ç†åå°èšç¾¤ç”Ÿå‘½å‘¨æœŸï¼ˆ`BackgroundColony`ï¼‰
  5. å®æ—¶ UI æ¸²æŸ“ï¼ˆstatus barã€è¯¦æƒ…é¢æ¿ã€æ¶ˆæ¯æ¸²æŸ“å™¨ï¼‰
  6. `.gitignore` ç»´æŠ¤
- **SRP è¯„ä¼°**: âš ï¸ **ä¸­åº¦è¿å** â€” ä½œä¸ºæ‰©å±•å…¥å£ï¼Œæ³¨å†Œé€»è¾‘ä¸å¯é¿å…åœ°é›†ä¸­ã€‚ä½† UI æ¸²æŸ“é€»è¾‘ï¼ˆ`buildLines`ã€`formatDuration` ç­‰ï¼‰å’Œåå°ç”Ÿå‘½å‘¨æœŸç®¡ç†å¯ä»¥æŠ½ç¦»ã€‚
- **å»ºè®®**: å°† UI æ¸²æŸ“æŠ½åˆ° `ant-colony/ui.ts`ï¼Œåå°ç®¡ç†æŠ½åˆ° `ant-colony/background.ts`

#### 8. `ant-colony/queen.ts` â€” èšç¾¤è°ƒåº¦æ ¸å¿ƒ
- **èŒè´£**: 4 é˜¶æ®µæµæ°´çº¿è°ƒåº¦ï¼ˆä¾¦å¯Ÿâ†’å·¥ä½œâ†’å®¡æŸ¥â†’å®Œæˆï¼‰ï¼ŒåŒ…å«ï¼š
  - èšç¾¤åˆå§‹åŒ–ä¸çŠ¶æ€ç®¡ç†
  - `runAntWave()` å¹¶å‘æ‰¹æ¬¡æ‰§è¡Œ
  - 429 é™æµé€€é¿ç­–ç•¥
  - å­ä»»åŠ¡å†²çªæ£€æµ‹ä¸ blocked è§£é™¤
  - è‡ªé€‚åº”å¹¶å‘é‡‡æ ·è§¦å‘
  - `resumeColony()` æ–­ç‚¹æ¢å¤
- **SRP è¯„ä¼°**: âš ï¸ **ä¸­åº¦è¿å** â€” ä½œä¸ºè°ƒåº¦æ ¸å¿ƒï¼Œç¼–æ’é€»è¾‘é›†ä¸­æ˜¯åˆç†çš„ï¼ˆç±»ä¼¼ Orchestrator æ¨¡å¼ï¼‰ã€‚ä½† `runAntWave()` å†…éƒ¨æ··åˆäº†å¹¶å‘æ§åˆ¶ã€é™æµé€€é¿ã€å†²çªæ£€æµ‹ä¸‰ä¸ªå…³æ³¨ç‚¹ã€‚
- **å»ºè®®**: å°† `runAntWave` ä¸­çš„é™æµé€€é¿é€»è¾‘æŠ½åˆ° `concurrency.ts`ï¼Œå†²çªæ£€æµ‹æŠ½åˆ° `deps.ts`

#### 9. `ant-colony/spawner.ts` â€” Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **èŒè´£**:
  1. èš‚èš ID ç”Ÿæˆï¼ˆ`makeAntId`ã€`makePheromoneId`ã€`makeTaskId`ï¼‰
  2. è§’è‰²æç¤ºè¯å®šä¹‰ï¼ˆ`CASTE_PROMPTS`ï¼‰
  3. æç¤ºè¯æ„å»ºï¼ˆ`buildPrompt`ï¼‰
  4. å­ä»»åŠ¡è§£æï¼ˆ`parseSubTasks`ï¼‰
  5. ä¿¡æ¯ç´ æå–ï¼ˆ`extractPheromones`ï¼‰
  6. SDK Session åˆ›å»ºä¸æ‰§è¡Œï¼ˆ`spawnAnt`ï¼‰
  7. Drone è§„åˆ™æ‰§è¡Œï¼ˆ`runDrone`ï¼‰
- **SRP è¯„ä¼°**: âš ï¸ **ä¸­åº¦è¿å** â€” 7 ä¸ªä¸åŒå…³æ³¨ç‚¹é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ã€‚ID ç”Ÿæˆã€æç¤ºè¯æ¨¡æ¿ã€è¾“å‡ºè§£æã€Session ç®¡ç†æ˜¯ 4 ä¸ªç‹¬ç«‹çš„å˜åŒ–è½´ã€‚
- **å»ºè®®**: æ‹†åˆ†ä¸ºï¼š
  - `ant-colony/prompts.ts` â€” è§’è‰²æç¤ºè¯ + æ„å»ºé€»è¾‘
  - `ant-colony/parser.ts` â€” å­ä»»åŠ¡è§£æ + ä¿¡æ¯ç´ æå–
  - `ant-colony/spawner.ts` â€” ä»…ä¿ç•™ `spawnAnt` + `runDrone`

#### 10. `ant-colony/nest.ts` â€” å…±äº«çŠ¶æ€ç®¡ç†
- **èŒè´£**: åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¨è¿›ç¨‹çŠ¶æ€åè°ƒï¼Œç®¡ç†ä»»åŠ¡ã€ä¿¡æ¯ç´ ã€èš‚èšçŠ¶æ€
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” æ‰€æœ‰æ–¹æ³•å›´ç»•åŒä¸€ä¸ªå…³æ³¨ç‚¹ï¼šèšå·¢çŠ¶æ€çš„ CRUDã€‚æ–‡ä»¶é”ã€åŸå­å†™å…¥ã€å¢é‡è¯»å–éƒ½æ˜¯è¯¥èŒè´£çš„å®ç°ç»†èŠ‚ã€‚

#### 11. `ant-colony/concurrency.ts` â€” è‡ªé€‚åº”å¹¶å‘æ§åˆ¶
- **èŒè´£**: ç³»ç»Ÿè´Ÿè½½é‡‡æ · + è‡ªé€‚åº”å¹¶å‘è°ƒèŠ‚ç®—æ³•
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯å‡½æ•°ï¼Œé›¶å†…éƒ¨ä¾èµ–ï¼Œå•ä¸€èŒè´£ã€‚æ˜¯å…¨é¡¹ç›®æœ€å¹²å‡€çš„æ¨¡å—ä¹‹ä¸€ã€‚

#### 12. `ant-colony/deps.ts` â€” ä¾èµ–å›¾åˆ†æ
- **èŒè´£**: é™æ€åˆ†æ import è¯­å¥æ„å»ºä¾èµ–å›¾ï¼Œè®¡ç®—ä¾èµ–æ·±åº¦ï¼Œæ£€æµ‹ä»»åŠ¡é—´ä¾èµ–
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯å‡½æ•°ï¼Œé›¶å†…éƒ¨ä¾èµ–ï¼Œå•ä¸€èŒè´£ã€‚ä¸ `concurrency.ts` å¹¶åˆ—æœ€å¹²å‡€ã€‚

#### 13. `ant-colony/types.ts` â€” èšç¾¤ç±»å‹ç³»ç»Ÿ
- **èŒè´£**: å®šä¹‰èšç¾¤æ‰€æœ‰ç±»å‹ï¼ˆ`AntCaste`ã€`Task`ã€`Pheromone`ã€`ColonyState` ç­‰ï¼‰+ `DEFAULT_ANT_CONFIGS` å¸¸é‡
- **SRP è¯„ä¼°**: âœ… **åŸºæœ¬ç¬¦åˆ** â€” ä½œä¸ºç±»å‹èšåˆæ¨¡å—ï¼Œé›†ä¸­å®šä¹‰æ˜¯åˆç†çš„ã€‚`DEFAULT_ANT_CONFIGS` æ˜¯ä¸ç±»å‹ç´§å¯†å…³è”çš„é»˜è®¤å€¼ï¼Œå¯æ¥å—ã€‚

---

## å››ã€SRP è¿åä¸¥é‡åº¦æ’åº

| æ’å | æ¨¡å— | ä¸¥é‡åº¦ | é—®é¢˜ |
|:---:|------|:---:|------|
| 1 | `src/utils/install.ts` | ğŸ”´ ä¸¥é‡ | å•å‡½æ•° 9 ç§æ–‡ä»¶ç”Ÿæˆï¼Œä»»ä½•æ ¼å¼å˜æ›´éƒ½è¦æ”¹æ­¤æ–‡ä»¶ |
| 2 | `src/types.ts` | ğŸŸ  ä¸­ç­‰ | ç±»å‹å®šä¹‰ä¸ 5 ä¸ªè¿è¡Œæ—¶å¸¸é‡æ³¨å†Œè¡¨æ··åˆ |
| 3 | `ant-colony/spawner.ts` | ğŸŸ¡ è½»ä¸­ | 7 ä¸ªå…³æ³¨ç‚¹é›†ä¸­ï¼šIDç”Ÿæˆ/æç¤ºè¯/è§£æ/Session |
| 4 | `ant-colony/index.ts` | ğŸŸ¡ è½»ä¸­ | UIæ¸²æŸ“+åå°ç®¡ç†+å‘½ä»¤æ³¨å†Œæ··åˆï¼ˆæ‰©å±•å…¥å£å¯æ¥å—ï¼‰ |
| 5 | `ant-colony/queen.ts` | ğŸŸ¢ è½»å¾® | ç¼–æ’æ ¸å¿ƒæ··åˆé™æµé€€é¿ï¼ˆOrchestrator æ¨¡å¼å¯æ¥å—ï¼‰ |
| 6 | `src/i18n.ts` | ğŸŸ¢ è½»å¾® | ç¿»è¯‘æ•°æ®+é€»è¾‘+UIäº¤äº’æ··åˆï¼ˆè§„æ¨¡å¯æ§ï¼‰ |

---

## äº”ã€ä¸¤å±‚è§£è€¦åˆ†æ

```
  src/ å±‚                          ant-colony/ å±‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ TUI é…ç½® â”‚ â•â• é›¶ import â•â•â•â•â•â• â”‚ èšç¾¤å¤šAgent  â”‚
  â”‚ å·¥å…·     â”‚                      â”‚ ç³»ç»Ÿ         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
       â”‚  install.ts å¤åˆ¶                  â”‚  pi æ‰©å±• API
       â”‚  æ‰©å±•æ–‡ä»¶åˆ°                       â”‚  (registerTool,
       â”‚  ~/.pi/agent/extensions/         â”‚   registerCommand,
       â”‚                                  â”‚   sendMessage, ...)
       â–¼                                  â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚        @mariozechner/pi-coding-agent        â”‚
  â”‚              (è¿è¡Œæ—¶å®¿ä¸»)                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®å‘ç°**: src/ å±‚ä¸ ant-colony/ å±‚ä¹‹é—´**é›¶ç›´æ¥ import**ï¼Œå®Œå…¨é€šè¿‡ pi æ‰©å±• API æ¡¥æ¥ã€‚è¿™æ˜¯ä¼˜ç§€çš„æ¶æ„è§£è€¦â€”â€”ä¸¤å±‚å¯ä»¥ç‹¬ç«‹æ¼”è¿›ï¼Œäº’ä¸å½±å“ã€‚å”¯ä¸€çš„è€¦åˆç‚¹æ˜¯ `install.ts` å°†æ‰©å±•æ–‡ä»¶ç‰©ç†å¤åˆ¶åˆ°ç”¨æˆ·ç›®å½•ã€‚
