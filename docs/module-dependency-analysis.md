# æ¨¡å—ä¾èµ–å›¾ä¸å•ä¸€èŒè´£åˆ†æ

> ç”Ÿæˆæ—¶é—´: 2026-02-16 | é‡æ„åæ›´æ–°
> åŸºäº commit 46c1d85 (refactor: å•ä¸€èŒè´£é‡æ„)

---

## ä¸€ã€å®Œæ•´ ASCII æ¨¡å—ä¾èµ–å›¾

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        oh-pi å®Œæ•´æ¨¡å—ä¾èµ–å…³ç³»å›¾                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ src/ å±‚ (TUI é…ç½®å·¥å…·) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚    â•‘
â•‘  â”‚              â”‚ src/index.ts â”‚ â—„â”€â”€ ä¸»å…¥å£ (96è¡Œ)                       â”‚    â•‘
â•‘  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚    â•‘
â•‘  â”‚                     â”‚                                                 â”‚    â•‘
â•‘  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚    â•‘
â•‘  â”‚         â”‚           â”‚               â”‚                                 â”‚    â•‘
â•‘  â”‚         â–¼           â–¼               â–¼                                 â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚    â•‘
â•‘  â”‚  â”‚ i18n.ts  â”‚ â”‚ types.ts â”‚ â”‚ utils/detect.tsâ”‚                        â”‚    â•‘
â•‘  â”‚  â”‚  (61è¡Œ)  â”‚ â”‚  (69è¡Œ)  â”‚ â”‚    (112è¡Œ)     â”‚                        â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚    â•‘
â•‘  â”‚       â”‚                                                               â”‚    â•‘
â•‘  â”‚       â–¼                                                               â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚    â•‘
â•‘  â”‚  â”‚ locales.ts â”‚  â”‚ registry.ts  â”‚                                    â”‚    â•‘
â•‘  â”‚  â”‚  (420è¡Œ)   â”‚  â”‚   (77è¡Œ)     â”‚                                    â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚    â•‘
â•‘  â”‚                         â”‚ (è¢« tui/*.ts + writers.ts import)           â”‚    â•‘
â•‘  â”‚                         â–¼                                             â”‚    â•‘
â•‘  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â•‘
â•‘  â”‚            â”‚utils/install.tsâ”‚â”€â”€â”€â”€â–¶â”‚ utils/resources.tsâ”‚              â”‚    â•‘
â•‘  â”‚            â”‚    (98è¡Œ)      â”‚     â”‚     (19è¡Œ)        â”‚              â”‚    â•‘
â•‘  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â•‘
â•‘  â”‚                    â”‚                                                  â”‚    â•‘
â•‘  â”‚                    â–¼                                                  â”‚    â•‘
â•‘  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚    â•‘
â•‘  â”‚            â”‚utils/writers.tsâ”‚ â—„â”€â”€ 8ä¸ªç‹¬ç«‹ writer å‡½æ•°                â”‚    â•‘
â•‘  â”‚            â”‚    (152è¡Œ)     â”‚                                        â”‚    â•‘
â•‘  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚  â€» src/index.ts è¿˜ import äº† 9 ä¸ª tui/* æ¨¡å—ï¼ˆå›¾ä¸­çœç•¥ï¼‰             â”‚    â•‘
â•‘  â”‚    welcome, mode-select, provider-setup, preset-select,               â”‚    â•‘
â•‘  â”‚    theme-select, keybinding-select, extension-select,                 â”‚    â•‘
â•‘  â”‚    agents-select, confirm-apply                                       â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                              â•‘
â•‘                          â•‘ æ— ç›´æ¥ import â•‘                                   â•‘
â•‘                          â•‘ é€šè¿‡ pi æ‰©å±•  â•‘                                   â•‘
â•‘                          â•‘ API æ¡¥æ¥      â•‘                                   â•‘
â•‘                          â–¼               â–¼                                   â•‘
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ant-colony/ å±‚ (èšç¾¤å¤š Agent ç³»ç»Ÿ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚    â•‘
â•‘  â”‚              â”‚ ant-colony/       â”‚ â—„â”€â”€ æ‰©å±•å…¥å£ (600è¡Œ)               â”‚    â•‘
â•‘  â”‚              â”‚   index.ts        â”‚                                    â”‚    â•‘
â•‘  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚    â•‘
â•‘  â”‚                      â”‚                                                â”‚    â•‘
â•‘  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚    â•‘
â•‘  â”‚          â”‚           â”‚            â”‚          â”‚                        â”‚    â•‘
â•‘  â”‚          â–¼           â–¼            â–¼          â–¼                        â”‚    â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â•‘
â•‘  â”‚   â”‚ queen.ts  â”‚ â”‚ nest.ts â”‚ â”‚ types.ts â”‚ â”‚ ui.ts â”‚                  â”‚    â•‘
â•‘  â”‚   â”‚  (640è¡Œ)  â”‚ â”‚ (298è¡Œ) â”‚ â”‚ (144è¡Œ)  â”‚ â”‚ (46è¡Œ)â”‚                  â”‚    â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â•‘
â•‘  â”‚         â”‚                         â–²                                   â”‚    â•‘
â•‘  â”‚         â”‚ imports                 â”‚ (è¢«æ‰€æœ‰æ¨¡å—ä¾èµ–)                   â”‚    â•‘
â•‘  â”‚    â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                                   â”‚    â•‘
â•‘  â”‚    â”‚    â”‚    â”‚        â”‚           â”‚                                   â”‚    â•‘
â•‘  â”‚    â–¼    â–¼    â–¼        â–¼           â”‚                                   â”‚    â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚    â•‘
â•‘  â”‚ â”‚spawner.tsâ”‚â”‚  deps.ts â”‚â”‚ concurrency.ts  â”‚                          â”‚    â•‘
â•‘  â”‚ â”‚  (309è¡Œ) â”‚â”‚  (94è¡Œ)  â”‚â”‚    (120è¡Œ)      â”‚                          â”‚    â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚    â•‘
â•‘  â”‚      â”‚                                                                â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚    â•‘
â•‘  â”‚  â”‚             â”‚                                                      â”‚    â•‘
â•‘  â”‚  â–¼             â–¼                                                      â”‚    â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚    â•‘
â•‘  â”‚ â”‚prompts.ts â”‚ â”‚parser.ts â”‚                                           â”‚    â•‘
â•‘  â”‚ â”‚  (98è¡Œ)   â”‚ â”‚  (72è¡Œ)  â”‚                                           â”‚    â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### è¯¦ç»†ä¾èµ–è¾¹åˆ—è¡¨

```
src/index.ts
  â”œâ”€â”€â–¶ src/i18n.ts              (selectLanguage, getLocale, t)
  â”œâ”€â”€â–¶ src/types.ts             (type OhPConfig)
  â”œâ”€â”€â–¶ src/utils/detect.ts      (detectEnv, type EnvInfo)
  â””â”€â”€â–¶ src/tui/*.ts Ã— 9        (welcome, mode-select, provider-setup, ...)

src/i18n.ts
  â”œâ”€â”€â–¶ src/types.ts             (type Locale)
  â””â”€â”€â–¶ src/locales.ts           (messages)

src/locales.ts
  â””â”€â”€â–¶ src/types.ts             (type Locale)

src/registry.ts
  â””â”€â”€â–¶ src/types.ts             (type ModelCapabilities)

src/tui/provider-setup.ts
  â”œâ”€â”€â–¶ src/types.ts             (type ProviderConfig, type DiscoveredModel)
  â””â”€â”€â–¶ src/registry.ts          (PROVIDERS)

src/tui/extension-select.ts
  â””â”€â”€â–¶ src/registry.ts          (EXTENSIONS)

src/tui/theme-select.ts
  â””â”€â”€â–¶ src/registry.ts          (THEMES)

src/tui/confirm-apply.ts
  â”œâ”€â”€â–¶ src/types.ts             (type OhPConfig)
  â””â”€â”€â–¶ src/utils/install.ts     (applyConfig, installPi, backupConfig)

src/utils/install.ts
  â””â”€â”€â–¶ src/utils/writers.ts     (writeProviderEnv, writeModelConfig, ...)

src/utils/writers.ts
  â”œâ”€â”€â–¶ src/types.ts             (type OhPConfig)
  â”œâ”€â”€â–¶ src/registry.ts          (KEYBINDING_SCHEMES, MODEL_CAPABILITIES, PROVIDERS)
  â”œâ”€â”€â–¶ src/utils/resources.ts   (resources)
  â””â”€â”€â–¶ src/utils/install.ts     (ensureDir, syncDir)

src/utils/detect.ts
  â””â”€â”€â–¶ (æ— å†…éƒ¨ä¾èµ–ï¼Œä»… node:* æ ‡å‡†åº“)

src/utils/resources.ts
  â””â”€â”€â–¶ (æ— å†…éƒ¨ä¾èµ–ï¼Œä»… node:path, node:url)

src/types.ts
  â””â”€â”€â–¶ (é›¶ä¾èµ–ï¼Œçº¯å¶èŠ‚ç‚¹)

ant-colony/index.ts
  â”œâ”€â”€â–¶ ant-colony/queen.ts      (runColony, resumeColony, QueenCallbacks)
  â”œâ”€â”€â–¶ ant-colony/nest.ts       (Nest)
  â”œâ”€â”€â–¶ ant-colony/types.ts      (ColonyState, ColonyMetrics, AntStreamEvent)
  â””â”€â”€â–¶ ant-colony/ui.ts         (formatDuration, formatCost, formatTokens, statusIcon, casteIcon)

ant-colony/queen.ts              â—„â”€â”€ æœ€é«˜æ‰‡å‡º (5 ä¸ªå†…éƒ¨ä¾èµ–)
  â”œâ”€â”€â–¶ ant-colony/types.ts      (ColonyState, Task, Ant, AntCaste, ...)
  â”œâ”€â”€â–¶ ant-colony/nest.ts       (Nest)
  â”œâ”€â”€â–¶ ant-colony/spawner.ts    (spawnAnt, runDrone, makeTaskId, makePheromoneId)
  â”œâ”€â”€â–¶ ant-colony/concurrency.ts(adapt, sampleSystem, defaultConcurrency)
  â””â”€â”€â–¶ ant-colony/deps.ts       (buildImportGraph, taskDependsOn)

ant-colony/spawner.ts
  â”œâ”€â”€â–¶ ant-colony/types.ts      (Ant, AntCaste, AntConfig, Task, AntStreamEvent)
  â”œâ”€â”€â–¶ ant-colony/nest.ts       (Nest)
  â”œâ”€â”€â–¶ ant-colony/prompts.ts    (CASTE_PROMPTS, buildPrompt)
  â””â”€â”€â–¶ ant-colony/parser.ts     (parseSubTasks, extractPheromones, ParsedSubTask)

ant-colony/prompts.ts
  â””â”€â”€â–¶ ant-colony/types.ts      (AntCaste, Task)

ant-colony/parser.ts
  â”œâ”€â”€â–¶ ant-colony/types.ts      (AntCaste, Pheromone, PheromoneType)
  â””â”€â”€â–¶ ant-colony/spawner.ts    (makePheromoneId)

ant-colony/ui.ts
  â””â”€â”€â–¶ ant-colony/types.ts      (ColonyState)

ant-colony/nest.ts
  â””â”€â”€â–¶ ant-colony/types.ts      (ColonyState, Task, Pheromone, Ant, ...)

ant-colony/concurrency.ts
  â””â”€â”€â–¶ ant-colony/types.ts      (ConcurrencyConfig, ConcurrencySample)

ant-colony/deps.ts
  â””â”€â”€â–¶ (é›¶å†…éƒ¨ä¾èµ–ï¼Œä»… node:fs, node:path)
```

---

## äºŒã€æ‰‡å…¥/æ‰‡å‡ºåˆ†æ

| æ¨¡å— | æ‰‡å…¥ (è¢«ä¾èµ–æ•°) | æ‰‡å‡º (ä¾èµ–æ•°) | è¡Œæ•° | è§’è‰² |
|------|:---:|:---:|:---:|------|
| `ant-colony/types.ts` | **8** | 0 | 144 | çº¯å¶èŠ‚ç‚¹ï¼Œå…¨å±‚åŸºç¡€ç±»å‹ |
| `src/types.ts` | **5** | 0 | 69 | çº¯å¶èŠ‚ç‚¹ï¼Œæ¥å£å®šä¹‰ |
| `src/registry.ts` | **3** | 1 | 77 | è¿è¡Œæ—¶å¸¸é‡æ³¨å†Œè¡¨ |
| `ant-colony/nest.ts` | 3 | 1 | 298 | å…±äº«çŠ¶æ€ç®¡ç† |
| `ant-colony/queen.ts` | 1 | **5** | 640 | æœ€é«˜æ‰‡å‡ºï¼Œè°ƒåº¦ç¼–æ’æ ¸å¿ƒ |
| `ant-colony/spawner.ts` | 2 | **4** | 309 | Agent ç”Ÿå‘½å‘¨æœŸç®¡ç† |
| `ant-colony/index.ts` | 0 (å¤–éƒ¨å…¥å£) | 4 | 600 | æ‰©å±•æ³¨å†Œå…¥å£ |
| `src/index.ts` | 0 (å¤–éƒ¨å…¥å£) | 3+9 tui | 96 | TUI æµç¨‹ç¼–æ’ |
| `src/utils/install.ts` | 2 | 1 | 98 | é…ç½®ç¼–æ’ |
| `src/utils/writers.ts` | 1 | 4 | 152 | é…ç½®æ–‡ä»¶ç”Ÿæˆ |
| `src/utils/resources.ts` | 2 | 0 | 19 | çº¯è·¯å¾„è§£æ |
| `src/utils/detect.ts` | 1 | 0 | 112 | ç¯å¢ƒæ£€æµ‹ |
| `src/i18n.ts` | 1+ | 2 | 61 | å›½é™…åŒ–é€»è¾‘ |
| `src/locales.ts` | 1 | 1 | 420 | ç¿»è¯‘æ•°æ® |
| `ant-colony/concurrency.ts` | 1 | 1 | 120 | è‡ªé€‚åº”å¹¶å‘ |
| `ant-colony/deps.ts` | 1 | 0 | 94 | ä¾èµ–å›¾åˆ†æ |
| `ant-colony/prompts.ts` | 1 | 1 | 98 | è§’è‰²æç¤ºè¯ |
| `ant-colony/parser.ts` | 1 | 2 | 72 | è¾“å‡ºè§£æ |
| `ant-colony/ui.ts` | 1 | 1 | 46 | UI æ ¼å¼åŒ– |

---

## ä¸‰ã€å„æ¨¡å—æ ¸å¿ƒèŒè´£ä¸ SRP è¯„ä¼°

### src/ å±‚ (19 ä¸ªæ¨¡å—, ~1,732 è¡Œ)

#### 1. `src/index.ts` â€” TUI æµç¨‹ç¼–æ’å™¨ (96è¡Œ)
- **èŒè´£**: æ£€æµ‹ç¯å¢ƒ â†’ é€‰è¯­è¨€ â†’ æ¬¢è¿ â†’ é€‰æ¨¡å¼ â†’ æ‰§è¡Œå¯¹åº”æµç¨‹ â†’ ç¡®è®¤åº”ç”¨
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯ç¼–æ’é€»è¾‘ï¼Œæ¯ä¸ªæ­¥éª¤å§”æ‰˜ç»™ä¸“é—¨æ¨¡å—

#### 2. `src/types.ts` â€” çº¯ç±»å‹å®šä¹‰ (69è¡Œ)
- **èŒè´£**: å®šä¹‰ `Locale`ã€`DiscoveredModel`ã€`ProviderConfig`ã€`OhPConfig`ã€`ModelCapabilities` æ¥å£
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” é‡æ„ååªå«æ¥å£/ç±»å‹å®šä¹‰ï¼Œé›¶è¿è¡Œæ—¶ä»£ç 

#### 3. `src/registry.ts` â€” è¿è¡Œæ—¶å¸¸é‡æ³¨å†Œè¡¨ (77è¡Œ)
- **èŒè´£**: 5 ä¸ªè¿è¡Œæ—¶å¸¸é‡ï¼šMODEL_CAPABILITIESã€PROVIDERSã€THEMESã€EXTENSIONSã€KEYBINDING_SCHEMES
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” ä» types.ts æ‹†å‡ºåï¼Œå•ä¸€èŒè´£ï¼šå¯é…ç½®é¡¹çš„æ³¨å†Œè¡¨

#### 4. `src/i18n.ts` â€” å›½é™…åŒ–é€»è¾‘ (61è¡Œ)
- **èŒè´£**: `t()` æ’å€¼å‡½æ•°ã€è¯­è¨€æ£€æµ‹ã€è¯­è¨€é€‰æ‹©äº¤äº’
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” é‡æ„åç¿»è¯‘æ•°æ®å·²è¿ç§»åˆ° locales.tsï¼Œåªä¿ç•™é€»è¾‘

#### 5. `src/locales.ts` â€” ç¿»è¯‘æ•°æ® (420è¡Œ)
- **èŒè´£**: 3 ç§è¯­è¨€ï¼ˆen/zh/frï¼‰çš„ç¿»è¯‘å­—å…¸
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯æ•°æ®ï¼Œæ–°å¢è¯­è¨€åªæ”¹æ­¤æ–‡ä»¶

#### 6. `src/utils/detect.ts` â€” ç¯å¢ƒæ£€æµ‹ (112è¡Œ)
- **èŒè´£**: æ£€æµ‹ pi å®‰è£…çŠ¶æ€ã€ç‰ˆæœ¬ã€å·²æœ‰é…ç½®ã€ç»ˆç«¯ä¿¡æ¯ã€å·²é…ç½® provider
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” å•ä¸€èŒè´£ï¼šæ”¶é›†ç¯å¢ƒä¿¡æ¯

#### 7. `src/utils/install.ts` â€” é…ç½®ç¼–æ’ (98è¡Œ)
- **èŒè´£**: `applyConfig()` ç¼–æ’ 8 ä¸ª writerã€`ensureDir`/`syncDir` å·¥å…·å‡½æ•°ã€`installPi`ã€`backupConfig`
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” é‡æ„å applyConfig ä»… 8 è¡Œç¼–æ’è°ƒç”¨ï¼Œä¸å«æ–‡ä»¶ç”Ÿæˆç»†èŠ‚

#### 8. `src/utils/writers.ts` â€” é…ç½®æ–‡ä»¶ç”Ÿæˆ (152è¡Œ)
- **èŒè´£**: 8 ä¸ªç‹¬ç«‹ writer å‡½æ•°ï¼Œæ¯ä¸ªè´Ÿè´£ä¸€ç§é…ç½®æ–‡ä»¶çš„ç”Ÿæˆ
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” æ¯ä¸ªå‡½æ•°èŒè´£å•ä¸€ï¼ŒæŒ‰æ–‡ä»¶ç±»å‹éš”ç¦»

#### 9. `src/utils/resources.ts` â€” èµ„æºè·¯å¾„è§£æ (19è¡Œ)
- **èŒè´£**: å°†é€»è¾‘èµ„æºåæ˜ å°„åˆ° `pi-package/` ä¸‹çš„ç‰©ç†è·¯å¾„
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯å‡½æ•°ï¼Œé›¶å‰¯ä½œç”¨

---

### ant-colony/ å±‚ (10 ä¸ªæ¨¡å—, ~2,421 è¡Œ)

#### 10. `ant-colony/index.ts` â€” æ‰©å±•å…¥å£ (600è¡Œ)
- **èŒè´£**: æ³¨å†Œå·¥å…·/å‘½ä»¤ã€ç®¡ç†åå°èšç¾¤ç”Ÿå‘½å‘¨æœŸã€å®æ—¶ UI é¢æ¿
- **SRP è¯„ä¼°**: âš ï¸ **è½»å¾®è¿å** â€” ä½œä¸ºæ‰©å±•å…¥å£æ³¨å†Œé€»è¾‘ä¸å¯é¿å…é›†ä¸­ã€‚UI æ ¼å¼åŒ–å·²æŠ½åˆ° ui.tsï¼Œå‰©ä½™çš„é¢æ¿æ„å»ºé€»è¾‘ï¼ˆbuildLinesï¼‰ä¸å…¥å£è€¦åˆè¾ƒæ·±ï¼Œè¿›ä¸€æ­¥æ‹†åˆ†æ”¶ç›Šæœ‰é™ã€‚

#### 11. `ant-colony/queen.ts` â€” èšç¾¤è°ƒåº¦æ ¸å¿ƒ (640è¡Œ)
- **èŒè´£**: 4 é˜¶æ®µæµæ°´çº¿è°ƒåº¦ï¼ˆä¾¦å¯Ÿâ†’å·¥ä½œâ†’å®¡æŸ¥â†’å®Œæˆï¼‰+ é™æµé€€é¿ + å†²çªæ£€æµ‹
- **SRP è¯„ä¼°**: âš ï¸ **è½»å¾®è¿å** â€” Orchestrator æ¨¡å¼ä¸‹ç¼–æ’é›†ä¸­æ˜¯åˆç†çš„ã€‚é™æµé€€é¿ä¸ wave å¾ªç¯æ·±åº¦è€¦åˆï¼Œå¼ºæ‹†åå¢å¤æ‚åº¦ã€‚

#### 12. `ant-colony/spawner.ts` â€” Agent ç”Ÿå‘½å‘¨æœŸç®¡ç† (309è¡Œ)
- **èŒè´£**: ID ç”Ÿæˆã€SDK Session åˆ›å»ºä¸æ‰§è¡Œï¼ˆspawnAntï¼‰ã€Drone è§„åˆ™æ‰§è¡Œï¼ˆrunDroneï¼‰
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” é‡æ„åæç¤ºè¯å’Œè§£æå™¨å·²æ‹†å‡ºï¼Œåªä¿ç•™ session ç®¡ç†

#### 13. `ant-colony/prompts.ts` â€” è§’è‰²æç¤ºè¯ (98è¡Œ)
- **èŒè´£**: CASTE_PROMPTS å®šä¹‰ + buildPrompt æ„å»º
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” å•ä¸€èŒè´£ï¼šèš‚èšè§’è‰²æç¤ºè¯ç®¡ç†

#### 14. `ant-colony/parser.ts` â€” è¾“å‡ºè§£æ (72è¡Œ)
- **èŒè´£**: parseSubTasksï¼ˆå­ä»»åŠ¡è§£æï¼‰+ extractPheromonesï¼ˆä¿¡æ¯ç´ æå–ï¼‰
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” å•ä¸€èŒè´£ï¼šèš‚èšè¾“å‡ºçš„ç»“æ„åŒ–è§£æ

#### 15. `ant-colony/ui.ts` â€” UI æ ¼å¼åŒ– (46è¡Œ)
- **èŒè´£**: formatDurationã€formatCostã€formatTokensã€statusIconã€casteIconã€buildReport
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯å±•ç¤ºé€»è¾‘ï¼Œé›¶å‰¯ä½œç”¨

#### 16. `ant-colony/nest.ts` â€” å…±äº«çŠ¶æ€ç®¡ç† (298è¡Œ)
- **èŒè´£**: åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¨è¿›ç¨‹çŠ¶æ€åè°ƒ
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” æ‰€æœ‰æ–¹æ³•å›´ç»•èšå·¢çŠ¶æ€ CRUD

#### 17. `ant-colony/concurrency.ts` â€” è‡ªé€‚åº”å¹¶å‘æ§åˆ¶ (120è¡Œ)
- **èŒè´£**: ç³»ç»Ÿè´Ÿè½½é‡‡æ · + è‡ªé€‚åº”å¹¶å‘è°ƒèŠ‚ç®—æ³•
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯å‡½æ•°ï¼Œé›¶å†…éƒ¨ä¾èµ–

#### 18. `ant-colony/deps.ts` â€” ä¾èµ–å›¾åˆ†æ (94è¡Œ)
- **èŒè´£**: é™æ€åˆ†æ import è¯­å¥æ„å»ºä¾èµ–å›¾
- **SRP è¯„ä¼°**: âœ… **ç¬¦åˆ** â€” çº¯å‡½æ•°ï¼Œé›¶å†…éƒ¨ä¾èµ–

#### 19. `ant-colony/types.ts` â€” èšç¾¤ç±»å‹ç³»ç»Ÿ (144è¡Œ)
- **èŒè´£**: å®šä¹‰èšç¾¤æ‰€æœ‰ç±»å‹ + DEFAULT_ANT_CONFIGS å¸¸é‡
- **SRP è¯„ä¼°**: âœ… **åŸºæœ¬ç¬¦åˆ** â€” ç±»å‹èšåˆæ¨¡å—ï¼Œé›†ä¸­å®šä¹‰åˆç†

---

## å››ã€SRP åˆè§„åº¦æ€»è§ˆ

### é‡æ„å‰ vs é‡æ„å

| æ¨¡å— | é‡æ„å‰ | é‡æ„å | æ”¹è¿› |
|------|:---:|:---:|------|
| `src/types.ts` | ğŸŸ  ä¸­ç­‰è¿å | âœ… ç¬¦åˆ | å¸¸é‡è¿ç§»åˆ° registry.ts |
| `src/utils/install.ts` | ğŸ”´ ä¸¥é‡è¿å | âœ… ç¬¦åˆ | 9 ç§ç”Ÿæˆæ‹†åˆ° writers.ts |
| `ant-colony/spawner.ts` | ğŸŸ¡ ä¸­åº¦è¿å | âœ… ç¬¦åˆ | æç¤ºè¯â†’prompts.ts, è§£æâ†’parser.ts |
| `ant-colony/index.ts` | ğŸŸ¡ ä¸­åº¦è¿å | âš ï¸ è½»å¾® | æ ¼å¼åŒ–å‡½æ•°â†’ui.ts |
| `src/i18n.ts` | ğŸŸ¢ è½»å¾®è¿å | âœ… ç¬¦åˆ | ç¿»è¯‘æ•°æ®â†’locales.ts |
| `ant-colony/queen.ts` | ğŸŸ¢ è½»å¾®è¿å | âš ï¸ è½»å¾® | ä¿æŒä¸å˜ï¼ˆå¼ºæ‹†æ”¶ç›Šä¸è¶³ï¼‰ |

### å½“å‰ SRP è¿åæ’åº

| æ’å | æ¨¡å— | ä¸¥é‡åº¦ | è¯´æ˜ |
|:---:|------|:---:|------|
| 1 | `ant-colony/index.ts` | âš ï¸ è½»å¾® | é¢æ¿æ„å»ºä¸å…¥å£æ³¨å†Œæ··åˆï¼ˆæ‰©å±•å…¥å£å¯æ¥å—ï¼‰ |
| 2 | `ant-colony/queen.ts` | âš ï¸ è½»å¾® | é™æµé€€é¿ä¸ç¼–æ’æ··åˆï¼ˆOrchestrator æ¨¡å¼å¯æ¥å—ï¼‰ |

---

## äº”ã€ä¸¤å±‚è§£è€¦åˆ†æ

```
  src/ å±‚ (19æ¨¡å—, ~1,732è¡Œ)       ant-colony/ å±‚ (10æ¨¡å—, ~2,421è¡Œ)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ TUI é…ç½® â”‚ â•â• é›¶ import â•â•â•â•â•â• â”‚ èšç¾¤å¤šAgent  â”‚
  â”‚ å·¥å…·     â”‚                      â”‚ ç³»ç»Ÿ         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
       â”‚  install.ts å¤åˆ¶                  â”‚  pi æ‰©å±• API
       â”‚  æ‰©å±•æ–‡ä»¶åˆ°                       â”‚  (registerTool,
       â”‚  ~/.pi/agent/extensions/         â”‚   registerCommand,
       â”‚                                  â”‚   sendMessage, ...)
       â–¼                                  â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚        @mariozechner/pi-coding-agent        â”‚
  â”‚              (è¿è¡Œæ—¶å®¿ä¸»)                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®å‘ç°**: src/ å±‚ä¸ ant-colony/ å±‚ä¹‹é—´**é›¶ç›´æ¥ import**ï¼Œå®Œå…¨é€šè¿‡ pi æ‰©å±• API æ¡¥æ¥ã€‚è¿™æ˜¯ä¼˜ç§€çš„æ¶æ„è§£è€¦â€”â€”ä¸¤å±‚å¯ä»¥ç‹¬ç«‹æ¼”è¿›ï¼Œäº’ä¸å½±å“ã€‚å”¯ä¸€çš„è€¦åˆç‚¹æ˜¯ `install.ts` å°†æ‰©å±•æ–‡ä»¶ç‰©ç†å¤åˆ¶åˆ°ç”¨æˆ·ç›®å½•ã€‚

---

## å…­ã€å¾ªç¯ä¾èµ–æ£€æµ‹

```
âš ï¸ å‘ç° 1 å¤„å¾ªç¯ä¾èµ–ï¼š

  src/utils/install.ts â”€â”€â–¶ src/utils/writers.ts
                     â—€â”€â”€
  (install.ts export ensureDir/syncDir, writers.ts import å®ƒä»¬)
  (install.ts import writers.ts çš„ 8 ä¸ª writer å‡½æ•°)

  ä¸¥é‡åº¦: ğŸŸ¢ ä½ â€” è¿™æ˜¯å·¥å…·å‡½æ•°ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„åŒå‘ä¾èµ–ï¼Œ
  TypeScript å¯ä»¥æ­£ç¡®å¤„ç†ï¼ˆéè¿è¡Œæ—¶å¾ªç¯ï¼‰ã€‚
  å¦‚éœ€æ¶ˆé™¤ï¼šå°† ensureDir/syncDir æŠ½åˆ° src/utils/fs-helpers.tsã€‚

å…¶ä½™æ¨¡å—å‡æ— å¾ªç¯ä¾èµ–ã€‚
```
